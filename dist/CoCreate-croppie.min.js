/* CoCreateJS */
let awsOption={region:"us-east-1",accessKeyId:"AKIAZKETJ5PSTFJ54J7O",secretAccessKey:"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"};var s3=new AWS.S3(awsOption);function uploadFile(e,t,o){let l={Bucket:"cocreate-test",Key:t,Body:e,ACL:"public-read-write"};s3.upload(l,function(e,t){o(e,t)})}function uploadImageData(e,t,o){let l={Bucket:"cocreate-test",Key:t,Body:dataURLtoFile(e,t),ACL:"public-read-write"};s3.upload(l,function(e,t){o(e,t)})}function dataURLtoFile(e,t){for(var o=e.split(","),l=o[0].match(/:(.*?);/)[1],n=atob(o[1]),a=n.length,i=new Uint8Array(a);a--;)i[a]=n.charCodeAt(a);return new File([i],t,{type:l})}var imageUploaders=[];function ImageUploder(e){let t=e.id,o=e.querySelector(".croppie"),l=e.querySelector("input[type='file']");if(!t||!o)return!1;let n=new Croppie(e,{viewport:{width:100,height:100},boundary:{width:200,height:200},showZoomer:!1,enableOrientation:!0,enableZoom:!0,mouseWheelZoom:"ctrl"});return l&&l.addEventListener("change",function(e){if(0==this.files.length)return;let t=this.files[0],o=new FileReader;o.onload=function(e){n.bind({url:e.target.result})},o.readAsDataURL(t)}),e.addEventListener("uploadImage",function(e){let t=e.detail.url;console.log(t);let o=this.id,l=document.querySelectorAll("[data-uploader_id='"+o+"'].imageInput");for(let e=0;e<l.length;e++){l[e].value=t}}),{eId:t,croppie:o,fileTag:l,el:e,resizer:n,bind:null}}function getCropResult(e,t){e.resizer.result("base64").then(function(e){t(e)})}function initImageuploaders(){let e=document.querySelectorAll(".image-uploader");for(let t=0;t<e.length;t++){initImageUploader(e[t])}}function initImageUploader(e){let t=ImageUploder(e);t&&imageUploaders.push(t)}function bindImageToUploader(e,t){}function triggerBindToUploader(e){let t=e.fileTag;t&&t.click()}function getUploaderById(e){for(let t=0;t<imageUploaders.length;t++)if(imageUploaders[t].eId==e)return imageUploaders[t];return!1}function initUploaderButtons(){let e=document.querySelectorAll(".imageUpload");for(let t=0;t<e.length;t++){e[t].addEventListener("click",function(e){let t=getUploaderById(this.getAttribute("data-uploader_id"));t&&triggerBindToUploader(t)})}let t=document.querySelectorAll(".imageSave");for(let e=0;e<t.length;e++){t[e].addEventListener("click",function(e){let t=getUploaderById(this.getAttribute("data-uploader_id"));t&&getCropResult(t,function(e){uploadImageData(e,getRandomImageName(20),function(e,o){if(o){let e=o.Location,l=new CustomEvent("uploadImage",{detail:{url:e}});t.el.dispatchEvent(l)}})})})}}function getRandomImageName(e){let t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l=o.length;for(let n=0;n<e;n++)t+=o.charAt(Math.floor(Math.random()*l));return t+".jpg"}initImageuploaders(),initUploaderButtons();